<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="bg-gradient-to-br from-gray-700 via-gray-900 to-black">
        <div class="flex items-center space-x-4 pt-6">
            <img id="smallpp" class="w-10 h-10 rounded-full" src="" alt="">
            <div class="font-medium dark:text-white">
                <div>Connected Account</div>
                <div id="uuid" class="text-sm text-gray-500 dark:text-gray-400"></div>
            </div>
        </div>
        <section class="py-5 ">
            <div class="container">
                <h1 class="text-4xl font-extrabold text-gray-900 dark:text-white">User's Account</h1>
                <div class="bg-white shadow rounded-lg d-block d-sm-flex">
                    <div class="profile-tab-nav border-right">
                        <div class="p-4">
                            <div class="img-circle text-center mb-3">
                                <img src="" alt="User Image" class="shadow" id="mainpp" width="100" height="100">
                            </div>
                            <h4 class="text-center">User's Panel</h4>
                        </div>
                        <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist"
                            aria-orientation="vertical">
                            <a class="nav-link active" id="notification-tab" data-toggle="pill" href="#notification"
                                role="tab" aria-controls="notification" aria-selected="true">
                                <i class="fa fa-bell text-center mr-1"></i>
                                Account Details
                            </a>
                            <a class="nav-link " id="account-tab" data-toggle="pill" href="#account" role="tab"
                                aria-controls="account" aria-selected="false">
                                <i class="fa fa-home text-center mr-1"></i>
                                Edit User Details
                            </a>
                            <button class="nav-link " id="signout" data-toggle="pill" role="tab" aria-controls="account"
                                aria-selected="false">
                                <i class="fa fa-home text-center mr-1"></i>
                                Sign Out
                            </button>




                        </div>
                    </div>
                    <div class="tab-content p-4 p-md-5" id="v-pills-tabContent">
                        <div class="tab-pane fade" id="account" role="tabpanel" aria-labelledby="account-tab">
                            <div id="update-form">
                                <h3 class="mb-4">Edit User Details</h3>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Photo Url</label>
                                            <input type="text" class="form-control" id="editurl">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Name</label>
                                            <input type="text" class="form-control" id="editname">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Email</label>
                                            <input type="email" class="form-control" id="editemail">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Phone Number</label>
                                            <input type="tel" class="form-control" id="editphone">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Gender</label>
                                            <input type="text" class="form-control" id="editgender">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Address</label>
                                            <input type="text" class="form-control" id="editaddress">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Organization</label>
                                            <input type="text" class="form-control" id="editorganization">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Designation</label>
                                            <input type="text" class="form-control" id="editdesignation" value>
                                        </div>
                                    </div>





                                </div>
                                <div>
                                    <button id="update"
                                        class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">Update</button>
                                </div>
                            </div>
                        </div>



                        <div class="tab-pane fade  show active" id="notification" role="tabpanel"
                            aria-labelledby="notification-tab">
                            <h2 class="mb-4">User's Details</h2>


                            <label for="default-search"
                                class="mb-2 text-sm font-medium text-gray-900 sr-only dark:text-white">Search</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">


                                </div>
                            </div>



                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Name</label>
                                        <p id="nameshow" class="text-2xl font-medium text-gray-900 "></p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Email</label>
                                        <p id="email" class="text-2xl font-medium text-gray-900 "></p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Phone Number</label>
                                        <p id="phone" class="text-2xl font-medium text-gray-900 "></p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Gender</label>
                                        <p id="gender" class="text-2xl font-medium text-gray-900 "></p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Address</label>
                                        <p id="address" class="text-2xl font-medium text-gray-900 "></p>
                                    </div>
                                </div>
                                <!-- <div class="col-md-6">
                                    <div class="form-group">
                                        <label>photourl</label>
                                        <p id="photourl" class="text-2xl font-medium text-gray-900 "></p>
                                    </div>
                                </div> -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Organization</label>
                                        <p id="organization" class="text-2xl font-medium text-gray-900 "></p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Designation</label>
                                        <p id="designation" class="text-2xl font-medium text-gray-900 "></p>
                                    </div>
                                </div>




                            </div>
                            <!-- <div>
			<button onclick="readContract7()" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">Submit</button>
		</div> -->



                        </div>
                    </div>
                </div>
            </div>
    </div>
    </section>
    </div>


    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>




    <!-- Your Firebase configuration and initialization code -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
        import {
            getFirestore, doc, getDoc, setDoc, collection, addDoc, updateDoc
        } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";
        try {
            const firebaseConfig = {
                apiKey: "AIzaSyDdNA85YFPLf8M3xO47wW-CE1O5UUBuOsk",
                authDomain: "userpage-33951.firebaseapp.com",
                projectId: "userpage-33951",
                storageBucket: "userpage-33951.appspot.com",
                messagingSenderId: "950594980527",
                appId: "1:950594980527:web:f536a29d10ed440367625a",
                measurementId: "G-3YBFCE7D36"
            };

            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore();
            const userDetailsDiv = document.getElementById('user-details');
            const signout = document.getElementById('signout');
            const update = document.getElementById('update');
            const pro = document.getElementById('profile')
            var nameshow = document.getElementById("nameshow");
            var profilepic = document.getElementById("profilepic")
            var mainpp = document.getElementById("mainpp")
            var smallpp = document.getElementById("smallpp")
            var uuid = document.getElementById("uuid")
            var email = document.getElementById("email")
            var phone = document.getElementById("phone")
            var gender = document.getElementById("gender")
            var address = document.getElementById("address")
            var organization = document.getElementById("organization")
            var deignation = document.getElementById("designation")
            var photourl = document.getElementById("photourl")
            var editurl = document.getElementById("editurl")
            var editname = document.getElementById("editname")
            var editemail = document.getElementById("editemail")
            var editphone = document.getElementById("editphone")
            var editgender = document.getElementById("editgender")
            var editaddress = document.getElementById("editaddress")
            var editdesignation = document.getElementById("editdesignation")
            var editorganization = document.getElementById("editorganization")

            // Add an authentication state change listener
            onAuthStateChanged(auth, (user) => {
                if (user) {

                    update.addEventListener('click', () => {
                        async function updatedocument() {
                            var ref = doc(db, "userlist", user.uid)
                            await updateDoc(
                                ref, {

                                userdisplayname: editname.value,
                                userphotourl: editurl.value,
                                useremail: editemail.value,
                                userphone: editphone.value,
                                usergender: editgender.value,
                                useraddress: editaddress.value,
                                userorganization: editorganization.value,
                                userdesignation: editdesignation.value
                            }
                            )
                                .then(() => {
                                    alert("updated successfully")
                                }).catch((error) => {
                                    alert("something went wrong " + error)
                                })
                        }
                        updatedocument()
                        // location.reload()
                    });
                    console.log(user)

                    async function getdocument() {
                        var ref = doc(db, "userlist", user.uid)
                        const docSnap = await getDoc(ref)
                        if (docSnap.exists()) {
                            //         pro.innerHTML = `

                            // `;

                            editurl.value = docSnap.data().userphotourl;
                            editname.value = docSnap.data().userdisplayname;
                            editemail.value = docSnap.data().useremail;
                            editphone.value = docSnap.data().userphone;
                            editgender.value = docSnap.data().usergender;
                            editaddress.value = docSnap.data().useraddress;
                            editorganization.value = docSnap.data().userorganization;
                            editdesignation.value = docSnap.data().userdesignation;



                            nameshow.innerText = docSnap.data().userdisplayname
                            smallpp.setAttribute("src", docSnap.data().userphotourl)
                            mainpp.setAttribute("src", docSnap.data().userphotourl)
                            uuid.innerText = docSnap.data().useruid
                            email.innerText = docSnap.data().useremail
                            phone.innerText = docSnap.data().userphone
                            gender.innerText = docSnap.data().usergender
                            address.innerText = docSnap.data().useraddress
                            organization.innerText = docSnap.data().userorganization
                            designation.innerText = docSnap.data().userdesignation
                            photourl.innerText = docSnap.data().userphotourl

                            // Populate form fields



                        } else {
                            console.log("no data available")
                        }
                    }
                    getdocument()



                } else {
                    // User is signed out
                    alert("User Signed out")


                }


            });


            // Add sign-out button functionality
            signout.addEventListener('click', () => {
                // Sign out the user
                signOut(auth)
                    .then(() => {
                        // Redirect to the sign-in page or any other page as needed
                        window.location.href = 'login.html';
                    })
                    .catch((error) => {
                        console.error('Sign out error:', error);
                    });
            });



        }
        catch (error) {
            console.log('Firebase initialization error:', error);
        }



    </script>
</body>

</html>